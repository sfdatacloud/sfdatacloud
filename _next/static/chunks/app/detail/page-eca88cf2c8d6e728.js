(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[786],{5828:(e,t,a)=>{Promise.resolve().then(a.bind(a,1639))},1639:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var l=a(878),s=a(5387),r=a(6782),i=a(9765),n=a(1634),o=a(6522),d=a(967),c=a(9874),u=a(9014),m=a(3004);let h=e=>(0,m.A)({method:"GET",url:"/api/books/detail/".concat(e)}),x=e=>(0,m.A)({url:"/api/books/analysis/records",method:"POST",data:e});var p=a(2060),v=a(5476);let f=e=>{let{xData:t,seriesData:a,title:s}=e,i=(0,r.useRef)(null),n=()=>{if(i.current){let e=v.Ts(i.current),l={title:{text:s||"Stacked Line",top:"0%"},tooltip:{trigger:"axis"},legend:{data:a.map(e=>e.name),top:"6%",left:"center"},grid:{top:"15%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:t},yAxis:{type:"value"},series:a};return e.setOption(l),window.addEventListener("resize",()=>{e.resize()}),()=>{window.removeEventListener("resize",()=>{e.resize()}),e.dispose()}}};return(0,r.useEffect)(()=>{n()},[t,a,s]),(0,l.jsx)("div",{ref:i,className:"w-full h-[600px]"})};var y=a(8343),j=a.n(y),b=a(1413),_=a(3431),g=a.n(_);let{Option:N}=n.A,w=e=>{let{value:t,onChange:a}=e,[s,i]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1),u=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(!0);try{var t,a;let l=await (0,b.c)({current:1,size:10,book_name:e,sort_type:"collect_num",label_type:""});"success"===l.code&&(null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.list)?i(null==l?void 0:null===(a=l.data)||void 0===a?void 0:a.list):o.Ay.error("Failed to fetch data")}catch(e){console.log(e),o.Ay.error("An error occurred")}finally{c(!1)}},m=(0,r.useCallback)(g()(u,300),[]);return(0,r.useEffect)(()=>{u()},[]),(0,l.jsxs)(n.A,{showSearch:!0,placeholder:"Select a book",value:t,onChange:a,onSearch:m,loading:d,filterOption:!1,style:{width:300},children:[(0,l.jsx)(N,{value:"",children:"不对比"},"0000"),s.map(e=>(0,l.jsx)(N,{value:e.b_id,children:e.book_name},e.b_id))]})},k=()=>(0,l.jsx)(u.A,{children:(0,l.jsx)("div",{className:"w-full h-full"})}),{RangePicker:A}=i.A,{Option:S}=n.A,Y=e=>e.map(e=>e.created_time),D=(e,t,a)=>({name:e,type:"line",data:t.map(e=>e[a])}),T=()=>{let[e,t]=o.Ay.useMessage(),a=(0,s.useSearchParams)(),[i,m]=(0,r.useState)([j()().subtract(365,"day"),j()()]),[v,y]=(0,r.useState)(""),[b,_]=(0,r.useState)(null),[g,N]=(0,r.useState)(null),[k,T]=(0,r.useState)([]),[M,C]=(0,r.useState)([]),[E,L]=(0,r.useState)(1),[O,z]=(0,r.useState)(!1),P=async()=>{let t=a.get("bookId");if(t){z(!0);try{let e=await h(t);"success"===e.code&&N(e.data)}catch(t){e.error("获取作品信息失败, 请前往提交入口, 提交收录")}finally{z(!1)}}else o.Ay.error("Book not found")},G=async()=>{if(v){z(!0);try{let e=await h(v);"success"===e.code&&_(e.data)}catch(t){e.error("获取作品信息失败, 请前往提交入口, 提交收录")}finally{z(!1)}}else o.Ay.error("Book not found")},I=async e=>{z(!0);try{let t=await x({b_id:Number(e),group_type:E,start_date:j()(i[0]).format("YYYY-MM-DD"),end_date:j()(i[1]).format("YYYY-MM-DD")});"success"===t.code?T(t.data):o.Ay.error("Failed to load book history")}finally{z(!1)}},q=async()=>{if(v){z(!0);try{let e=await x({b_id:Number(v),group_type:E,start_date:j()(i[0]).format("YYYY-MM-DD"),end_date:j()(i[1]).format("YYYY-MM-DD")});"success"===e.code?C(e.data):o.Ay.error("Failed to load book history")}finally{z(!1)}}},B=(0,r.useMemo)(()=>!!g&&((0,p.G)(g.last_update_time,g.finish)?(0,l.jsx)(d.A,{title:"已太监, 作品数据将不再维护, 恢复更新后, 请手动提交维护。",children:"已太监"}):1===g.finish?(0,l.jsx)(d.A,{title:"完结作品数据将不再维护, 状态如有更新, 请手动提交维护。",children:"已完结"}):"连载中"),[g]);(0,r.useEffect)(()=>{P();let e=a.get("bookId");e&&I(e)},[]);let F=(0,r.useCallback)((e,t)=>{var a,s,r;if(!(M.length>0)||!v)return(0,l.jsx)(f,{xData:Y(k),title:t,seriesData:[D(null!==(r=null==g?void 0:g.book_name)&&void 0!==r?r:"",k,"collect_num")]});{let{alignedArr1:r,alignedArr2:i}=(0,p.v)(k,M);return(0,l.jsx)(f,{xData:Y(r),title:t,seriesData:[D(null!==(a=null==g?void 0:g.book_name)&&void 0!==a?a:"",r,e),D(null!==(s=null==b?void 0:b.book_name)&&void 0!==s?s:"",i,e)]})}},[k,g,M,b]);return(0,l.jsxs)("div",{children:[t,(0,l.jsx)("h1",{children:"作品详情/历史数据"}),(0,l.jsx)("p",{className:"text-primary",children:"注意: 连载作品超过30天未更新, 状态视为太监, 数据将不再进行维护。完结作品数据, 也将不再维护。"}),(0,l.jsx)("p",{className:"text-primary mt-2",children:"默认最大查询时间范围为: 1年；按年查询, 范围最大5年。"}),(0,l.jsxs)("div",{className:"query mt-4 gap-4 custom-mobile:flex-col flex items-start",children:[(0,l.jsxs)("div",{className:"line flex items-center",children:[(0,l.jsx)("div",{className:"label w-[100px]",children:"时间范围:"}),(0,l.jsx)(A,{value:i,onChange:e=>m(e)})]}),(0,l.jsxs)("div",{className:"line flex items-center",children:[(0,l.jsx)("div",{className:"label w-[100px]",children:"分组类型:"}),(0,l.jsxs)(n.A,{value:E,onChange:L,children:[(0,l.jsx)(S,{value:1,children:"天"}),(0,l.jsx)(S,{value:2,children:"月"}),(0,l.jsx)(S,{value:3,children:"年"})]})]}),(0,l.jsxs)("div",{className:"line flex items-center",children:[(0,l.jsx)("div",{className:"label w-[100px]",children:"对比作品:"}),(0,l.jsx)(w,{value:v,onChange:y})]}),(0,l.jsx)("div",{children:(0,l.jsx)(c.Ay,{type:"primary",onClick:()=>{I(a.get("bookId")),q(),G()},children:"查询"})})]}),(0,l.jsx)(u.A,{spinning:O,children:(0,l.jsxs)("div",{className:"book-detail mt-4 p-2 grid custom-pc:grid-cols-2 gap-4 custom-mobile:grid-cols-1",children:[(0,l.jsxs)("div",{className:"detail shadow flex",children:[(0,l.jsx)("div",{className:"flex-1 mr-2",children:(0,l.jsx)("img",{className:"w-full",src:null==g?void 0:g.cover_url,alt:"cover_url"})}),(0,l.jsxs)("div",{className:"infos mt-4 flex-1 flex flex-col",children:[(0,l.jsx)("h2",{className:"text-theme-brand mb-4 text-[24px]",children:null==g?void 0:g.book_name}),(0,l.jsxs)("p",{className:"flex text-grayLine",children:[(0,l.jsx)("span",{className:"label w-[40px]",children:"字数:"}),null==g?void 0:g.word_count.toLocaleString()]}),(0,l.jsxs)("p",{className:"flex mt-2 text-grayLine",children:[(0,l.jsx)("span",{className:"label w-[40px]",children:"类型:"}),null==g?void 0:g.book_type]}),(0,l.jsxs)("p",{className:"flex text-grayLine mt-2",children:[(0,l.jsx)("span",{className:"label w-[40px]",children:"状态:"}),B]})]})]}),(0,l.jsx)("div",{className:"date-line shadow p-4",children:F("tap_num","点击数据")}),(0,l.jsx)("div",{className:"date-line shadow p-4",children:F("like_num","点赞数据")}),(0,l.jsx)("div",{className:"date-line shadow p-4",children:F("collect_num","收藏数据")}),(0,l.jsx)("div",{className:"date-line shadow p-4",children:F("comment_num","评论数据")}),(0,l.jsx)("div",{className:"date-line shadow p-4",children:F("comment_long_num","长评数据")}),(0,l.jsx)("div",{className:"date-line shadow p-4",children:F("monthly_pass","月票数据")})]})})]})},M=()=>(0,l.jsx)(r.Suspense,{fallback:(0,l.jsx)(k,{}),children:(0,l.jsx)(T,{})})},1413:(e,t,a)=>{"use strict";a.d(t,{c:()=>s,l:()=>r});var l=a(3004);let s=e=>(0,l.A)({method:"POST",url:"/api/books/rank/records",data:e}),r=e=>(0,l.A)({method:"POST",url:"/api/books/label/query",data:{keyword:e}})},3004:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var l=a(5118);let s=async e=>(e.baseURL="http://servexuehua.asuscomm.com:18080",e);var r=a(6522);let i=async e=>{var t;throw(null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.data.code)==="error"&&r.Ay.error(e.response.data.error),e},n=l.A.create({timeout:18e4});n.interceptors.request.use(s,e=>e),n.interceptors.response.use(e=>e.data instanceof Blob?e:("success"===e.data.code&&e.data.data||r.Ay.info(e.data.message),e.data),i);let o=n},2060:(e,t,a)=>{"use strict";a.d(t,{G:()=>r,v:()=>i});var l=a(8343),s=a.n(l);let r=(e,t)=>{let a=s()(e);return s()().diff(a,"day")>30&&0===t};function i(e,t){let a=e=>new Date(e);e.sort((e,t)=>a(e.created_time).getTime()-a(t.created_time).getTime()),t.sort((e,t)=>a(e.created_time).getTime()-a(t.created_time).getTime());let l=[],s=[],r=0,i=0,n=null,o=null;for(;r<e.length||i<t.length;){let d=r<e.length?a(e[r].created_time):null,c=i<t.length?a(t[i].created_time):null;d&&(!c||d<c)?(n=e[r],l.push(n),s.push(o||n),r++):c&&(!d||c<d)?(o=t[i],s.push(o),l.push(n||o),i++):d&&c&&d.getTime()===c.getTime()&&(n=e[r],o=t[i],l.push(n),s.push(o),r++,i++)}return{alignedArr1:l,alignedArr2:s}}}},e=>{var t=t=>e(e.s=t);e.O(0,[486,149,488,951,78,502,819,358],()=>t(5828)),_N_E=e.O()}]);