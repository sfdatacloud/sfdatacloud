(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{5450:(e,t,l)=>{Promise.resolve().then(l.bind(l,1433))},1433:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>b});var a=l(878),s=l(4753),n=l(967),r=l(3988),i=l(1634),d=l(9874),c=l(7924),o=l(3260),u=l(6782);let m=[{label:"点赞数",value:"like_num"},{label:"收藏数",value:"collect_num"},{label:"评论数",value:"comment_num"},{label:"长评数",value:"comment_long_num"},{label:"点击数",value:"tap_num"},{label:"月票数",value:"monthly_pass"}];var h=l(1413);let x=e=>{let{value:t,className:l,onChange:s,placeholder:n}=e,[r,d]=(0,u.useState)([]),c=async()=>{let e=await (0,h.l)("");"success"===e.code&&(null==e?void 0:e.data)&&d([{label:"全部",value:""},...e.data.map(e=>({label:e,value:e}))])};return(0,u.useEffect)(()=>{c()},[]),(0,a.jsx)(i.A,{className:l,showSearch:!0,placeholder:n,onChange:e=>s(e),value:t,options:r})};var _=l(1729),v=l.n(_),p=l(5387),k=l(2060);let b=()=>{let e=(0,p.useRouter)(),[t,l]=(0,u.useState)(!1),_=(0,u.useRef)(null),[b,y]=(0,u.useState)(600),[w,f]=(0,u.useState)(""),[g,j]=(0,u.useState)("collect_num"),[N,S]=(0,u.useState)(""),[A,I]=(0,u.useState)([]),[L,C]=(0,u.useState)(1),[E,T]=(0,u.useState)(20),[z,O]=(0,u.useState)(0);(0,u.useEffect)(()=>{let e=()=>{_.current&&y(_.current.clientHeight)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]);let q=(0,u.useMemo)(()=>{let t=[{width:80,title:"排名",dataIndex:"rank",fixed:!0,key:"rank"},{width:150,title:"书名",dataIndex:"book_name",key:"book_name",render:(t,l)=>(0,a.jsx)("div",{onClick:()=>{e.push("/detail?bookId=".concat(l.b_id))},className:"text-primary cursor-pointer",children:t})},{width:70,title:"类型",dataIndex:"book_type",key:"book_type"},{width:150,title:"征文类型",dataIndex:"label_type",key:"label_type"},{width:150,title:"标签",dataIndex:"tags",key:"tags",render(e,t){let l=(0,k.G)(t.last_update_time,t.finish),r=e.split(",").map(e=>(0,a.jsx)(s.A,{className:"ml-1 mb-1",color:"blue",bordered:!1,children:e},e));return 1===t.finish?r.push((0,a.jsx)(n.A,{title:"作品已完结, 数据不再维护, 状态如有更新, 请手动提交维护，",children:(0,a.jsx)(s.A,{className:"ml-1 mb-1",color:"success",bordered:!1,children:"完结"},"太监")})):l?r.push((0,a.jsx)(n.A,{title:"超过30天未更新, 将不再维护作品数据。作品恢复更新后, 请手动提交维护。",children:(0,a.jsx)(s.A,{className:"ml-1 mb-1",color:"red",bordered:!1,children:"太监"},"太监")})):r.push((0,a.jsx)(n.A,{title:"正常连载中, 如果30天未更新, 作品将会太监, 数据不再正常维护。",children:(0,a.jsx)(s.A,{className:"ml-1 mb-1",color:"success",bordered:!1,children:"连载中"},"太监")})),r}},{width:150,title:"封面",dataIndex:"cover_url",key:"cover_url",render:e=>(0,a.jsx)("img",{src:e,alt:"cover",style:{width:"120px",height:"auto"}})},{width:150,title:"字数",dataIndex:"word_count",key:"word_count",render:e=>e.toLocaleString()},{width:150,title:"点击数",dataIndex:"tap_num",key:"tap_num",render:e=>e.toLocaleString()},{width:150,title:"点赞数",dataIndex:"like_num",key:"like_num",render:e=>e.toLocaleString()},{width:150,title:"收藏数",dataIndex:"collect_num",key:"collect_num",render:e=>e.toLocaleString()},{width:150,title:"评论数",dataIndex:"comment_num",key:"comment_num",render:e=>e.toLocaleString()},{width:150,title:"长评数",dataIndex:"comment_long_num",key:"comment_long_num",render:e=>e.toLocaleString()},{width:150,title:"月票",dataIndex:"monthly_pass",key:"monthly_pass",render:e=>e.toLocaleString()},{width:150,title:"主站月票排名",dataIndex:"monthly_ticket_ranking",key:"monthly_ticket_ranking"},{width:150,title:"主站打赏排名",dataIndex:"reward_ranking",key:"reward_ranking"},{width:120,title:"数据刷新时间",dataIndex:"created_time",key:"created_time"},{width:160,title:"作品最后更新时间",dataIndex:"last_update_time",key:"last_update_time"}];for(let e in t){let l=t[e];if(l.key===g){let a=v().cloneDeep(l);t.splice(Number(e),1),t.splice(6,0,a);break}}return t},[A]),P=async(e,t)=>{l(!0);try{let s=await (0,h.c)({current:e||L,size:t||L,sort_type:g,label_type:N,book_name:w});if("success"===s.code&&(null==s?void 0:s.data)){var a;I(null===(a=s.data)||void 0===a?void 0:a.list),O(s.data.total_num),e&&t&&(C(e),T(t)),l(!1)}}catch(e){console.log(e),l(!1)}};return(0,u.useEffect)(()=>{P(1,10)},[]),(0,a.jsxs)("div",{className:"p-2 w-full h-full flex flex-col books-rank",children:[(0,a.jsx)("div",{className:"query mt-4",children:(0,a.jsxs)("div",{className:"flex custom-mobile:flex-col gap-4",children:[(0,a.jsxs)("div",{className:"item flex items-center",children:[(0,a.jsx)("div",{className:"label w-[80px]",children:"书名:"}),(0,a.jsx)("div",{className:"content",children:(0,a.jsx)(r.A,{value:w,onChange:e=>f(e.target.value)})})]}),(0,a.jsxs)("div",{className:"item flex items-center",children:[(0,a.jsx)("div",{className:"label w-[80px]",children:"排序方式:"}),(0,a.jsx)("div",{className:"content",children:(0,a.jsx)(i.A,{className:"w-[90px]",options:m,onChange:e=>j(e),value:g})})]}),(0,a.jsxs)("div",{className:"item flex items-center",children:[(0,a.jsx)("div",{className:"label w-[80px]",children:"征文类型:"}),(0,a.jsx)("div",{className:"content",children:(0,a.jsx)(x,{placeholder:"请选择征文类型",className:"w-[210px]",onChange:e=>S(e),value:N})})]}),(0,a.jsx)("div",{className:"item flex items-center",children:(0,a.jsx)(d.Ay,{onClick:()=>{P(1,E)},children:"查询"})})]})}),(0,a.jsx)("div",{ref:_,className:"table h-[80vh] relative mt-4 w-full overflow-hidden",children:(0,a.jsx)("div",{className:"absolute w-full h-full",children:(0,a.jsx)(c.A,{loading:t,tableLayout:"fixed",pagination:!1,scroll:{x:q.reduce((e,t)=>e+=null==t?void 0:t.width,0),y:b-100},columns:q,className:"w-full",bordered:!0,dataSource:A,rowKey:"id"})})}),(0,a.jsx)("div",{className:"page flex justify-end",children:(0,a.jsx)(o.A,{onChange:(e,t)=>{P(e,t)},defaultCurrent:L,total:z,pageSize:E})})]})}},1413:(e,t,l)=>{"use strict";l.d(t,{c:()=>s,l:()=>n});var a=l(3004);let s=e=>(0,a.A)({method:"POST",url:"/api/books/rank/records",data:e}),n=e=>(0,a.A)({method:"POST",url:"/api/books/label/query",data:{keyword:e}})},3004:(e,t,l)=>{"use strict";l.d(t,{A:()=>d});var a=l(5118);let s=async e=>(e.baseURL="http://servexuehua.asuscomm.com:18080",e);var n=l(6522);let r=async e=>{var t;throw(null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.data.code)==="error"&&n.Ay.error(e.response.data.error),e},i=a.A.create({timeout:18e4});i.interceptors.request.use(s,e=>e),i.interceptors.response.use(e=>e.data instanceof Blob?e:("success"===e.data.code&&e.data.data||n.Ay.info(e.data.message),e.data),r);let d=i},2060:(e,t,l)=>{"use strict";l.d(t,{G:()=>n,v:()=>r});var a=l(8343),s=l.n(a);let n=(e,t)=>{let l=s()(e);return s()().diff(l,"day")>30&&0===t};function r(e,t){let l=e=>new Date(e);e.sort((e,t)=>l(e.created_time).getTime()-l(t.created_time).getTime()),t.sort((e,t)=>l(e.created_time).getTime()-l(t.created_time).getTime());let a=[],s=[],n=0,r=0,i=null,d=null;for(;n<e.length||r<t.length;){let c=n<e.length?l(e[n].created_time):null,o=r<t.length?l(t[r].created_time):null;c&&(!o||c<o)?(i=e[n],a.push(i),s.push(d||i),n++):o&&(!c||o<c)?(d=t[r],s.push(d),a.push(i||d),r++):c&&o&&c.getTime()===o.getTime()&&(i=e[n],d=t[r],a.push(i),s.push(d),n++,r++)}return{alignedArr1:a,alignedArr2:s}}}},e=>{var t=t=>e(e.s=t);e.O(0,[265,486,149,488,951,604,794,502,819,358],()=>t(5450)),_N_E=e.O()}]);